INSERT INTO BS.SPYTNIK_X 
      (ID_SIGNAL,
       FREQUENCY,
       HERTZ,
       ARRIVAL_DATE,
       LOAD_STATUS,
       CURRENT_DATE,
       LOCATION,
       DEPARTURE_STATUS,
       TEMPERATURE,
       NAVIGATION,
       ERROR_INDICATION,
       TRAVEL_TIME,
       TIME_BEFORE_ARRIVAL,
       COORDINATES
      )
          (SELECT DISTINCT 
          TO_CHAR(A.ID_SIGNAL), 
          A.FREQUENCY, 
          A.HERTZ,
          TO_DATE(A.DEPARTURE_DATE, 'DD.MM.RRRR') AS ARRIVAL_DATE,
          A.LOAD_STATUS ,
          TO_DATE(A.CURRENT_DATE,'DD.MM.YYYY') AS CURRENT_DATE ,
          A.LOCATION, 
          MIN(B.DEPARTURE_DATE) OVER(PARTITION BY B.MM, B.ID_SIGNAL)AS DEPARTURE_DATE,
          A.TEMPERATURE,
          A.NAVIGATION,
          B.ERROR_INDICATION,
          A.TRAVEL_TIME, 
          A.TIME_BEFORE_ARRIVAL, 
          A.COORDINATES
          
  FROM BS.EARTH_STATION A
  JOIN BS.NAVIGATION B ON TO_CHAR(A.ID_SIGNAL) = TO_CHAR(B.ID_SIGNAL)
  WHERE TO_CHAR(A.DEPARTURE_DATE, 'YYYYQ') >= 20194
    AND (DECODE(A.LOAD_STATUS,'Согласованные','2','Оперативные','1'), A.LOCATION)
         IN (SELECT MAX(CASE
                            WHEN T1.LOAD_STATUS = 'Согласованные' THEN '2'
                            WHEN T1.LOAD_STATUS = 'Оперативные' THEN '1' END) LOAD_STATUS, T1.LOCATION
            FROM BS.EARTH_STATION T1
            WHERE TO_CHAR(T1.CURRENT_DATE,'YYYYMM') = TO_CHAR(A.CURRENT_DATE,'YYYYMM')
            AND TO_CHAR(T1.DEPARTURE_DATE,'YYYYMM') = TO_CHAR(A.DEPARTURE_DATE,'YYYYMM')
             GROUP BY LOCATION));
